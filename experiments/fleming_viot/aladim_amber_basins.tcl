
variable minima [list \
[list -141.0 6.0 ] \
[list -69.0 -14.0] \
[list -147.0	164.0] \
[list -65.0 156.0] \
[list 53.0 28.0] \
[list 57.0 180.0]\
]

variable freqs [list 1.0 2.0 3.0 4.0 5.0 6.0 7.0 8.0 9.0 10.0]

variable constants [list 89.16834170854271 74.821608040201 80.65577889447236 69.32914572864321 87.91708542713567 64.64572864321607]

variable cos_coeff [list \
[list -35.508897440516314	-22.37755259575369	6.885247598103367	-4.959758725328422	11.246758915801635	-0.09958249234395553	-4.491158105069887	-0.2812680542194088	-1.3936853190779495	3.238567678362382]\
[list 24.71728886896104	-24.651508811377337	-4.013608581560236	6.643039921130459	-4.05774967599976	-2.096257834377343	1.8285688197959626	-1.334333546121714	-0.4777689236459461	2.3794013152821103]\
[list -27.291667765371187	-1.9714944958806235	-7.3386435090718045	-6.271681640744392	5.915265046483853	1.3348375247805309	1.827065042508763	0.20720123691964804	-3.0109564746589497	0.36463338808210044]\
[list 21.630312986936985	-11.62561817536787	0.610997797905817	0.551033265298825	-0.5158600624774012	1.4455226193112387	-1.0502303855297255	-2.5296429100506743	-0.9165525349634127	1.0508666871734462]\
[list 9.364222376737924	-19.240764315555253	-2.264623374179049	8.670816600544729	5.30024552766912	-0.15141276461165948	0.92418249640254	-1.3157217272809496	-1.2928027501975394	1.1645063233547333]\
[list 4.649644482125654	-6.062618827242055	-7.0543167969162095	-4.506549371179236	-0.10326928724106482	2.213653594690318	2.826072617590809	-0.7730145053520845	-1.5234308060251274	-0.6269408354447137]\
]

variable sin_coeff [list \
[list -13.03198458601364	7.569702170752651	2.8853979504894705	1.0572049424697836	-0.7638064101351678	1.0566931469447332	-3.6345036778884157	3.0905165734377635	-0.2770658756999573	-0.5907696116887176]\
[list -7.8940750410410505	-10.172835574508166	-5.061484786587636	3.799256215823476	1.385819549446481	-3.5592744251726165	-0.41738288826426795	2.3670183774622346	0.8215730632906615	0.3116193423644663]\
[list 6.613666244657951	1.614667031274223	-2.678585511553332	-0.5172953162080178	-1.4009701478840881	0.3688242031696011	0.35847885651419215	0.4017399483316108	0.4406777305907601	-0.31301511694634765]\
[list -3.666871450856224	-8.056155323723218	-6.705218482099815	1.4964532737906149	2.475128405601351	-4.0652362333802685	-3.031120933653336	1.473731243285279	1.030848683206133	0.3229316979454916]\
[list -8.400709822466192	-8.70968014824372	9.632350676539067	5.019770197562622	-0.3838147966320849	-4.370656767247724	-2.21906476599007	2.5842252928334224	1.8294657314391998	-0.17892720487318975]\
[list 6.655503594037652	-8.066912740858765	3.1163750444108778	3.3707227605668137	3.0029655089475145	0.35912000672218003	-0.6015033204612299	-0.7467204638948207	-0.9649382605422234	0.47764291259181724]\
]

proc calc_instate_id { id } {
    cv help
    set phi [cv colvar phi value]
    set psi [cv colvar psi value]

    set phim [lindex $::minima $id 0]
    set psim [lindex $::minima $id 1]

    # translate to closest periodic image

    set phi [expr {abs($phi - 360 - $phim) < abs($phi - $phim) ? $phi - 360 : $phi}]
    set psi [expr {abs($psi - 360 - $psim) < abs($psi - $psim) ? $psi - 360 : $psi}]

    set phi [expr {abs($phi + 360 - $phim) < abs($phi + $phim) ? $phi + 360 : $phi}]
    set psi [expr {abs($psi + 360 - $psim) < abs($psi - $psim) ? $psi + 360 : $psi}]

    # compute polar coordinates

    set r [expr {sqrt(($phi - $phim)*($phi - $phim) + ($psi - $psim)*($psi - $psim))}]
    set t [expr {atan2($psi - $psim, $phi - $phim)}]

    set R [lindex $::constants $id]
    set i 0

    foreach f $::freqs {
        set R [expr {$R + [lindex $::cos_coeff $id $i]*cos($f*$t) + [lindex $::sin_coeff $id $i]*sin($f*$t)}]
        incr i
    }

    return [expr { $r < $R ? 1 : 0}]
}

proc calc_instate0 { args } { return [calc_instate_id 0] }

proc calc_instate1 { args } { return [calc_instate_id 1] }

proc calc_instate2 { args } { return [calc_instate_id 2] }

proc calc_instate3 { args } { return [calc_instate_id 3] }

proc calc_instate4 { args } { return [calc_instate_id 4] }

proc calc_instate5 { args } { return [calc_instate_id 5] }

proc calc_instate0_grad { args } { return 0.0 }

proc calc_instate1_grad { args } { return 0.0 }

proc calc_instate2_grad { args } { return 0.0 }

proc calc_instate3_grad { args } { return 0.0 }

proc calc_instate4_grad { args } { return 0.0 }

proc calc_instate5_grad { args } { return 0.0 }